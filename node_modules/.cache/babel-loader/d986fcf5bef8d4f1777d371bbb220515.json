{"ast":null,"code":"import _objectSpread from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useState}from'react';import Metamask from'./Metamask';import{TextField,TableBody,TableCell,TableContainer,TableHead,TableRow,Paper,Button,CircularProgress,Table}from'@mui/material';import axios from'axios';import{AppContext}from'../context/AppContext';import{numberWithCommas}from'./NFTs/NFTs';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MarketHistory=function MarketHistory(){var _useContext=useContext(AppContext),currentAccount=_useContext.currentAccount;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),historyList=_useState4[0],setHistoryList=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),length=_useState6[0],setLength=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),totalList=_useState8[0],setTotalList=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),totalBuy=_useState10[0],setTotalBuy=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),totalSell=_useState12[0],setTotalSell=_useState12[1];var getMarketHistory=function getMarketHistory(pageNo,pageSize){return axios(\"https://market-api.radiocaca.com/users/\".concat(currentAccount,\"/histories?pageNo=\").concat(pageNo,\"&pageSize=\").concat(pageSize)).then(function(res){return res.data;});};useEffect(function(){var getHistoryData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var pageNo,pageSize;return _regeneratorRuntime.wrap(function _callee2$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:pageNo=1;pageSize=10;getMarketHistory(pageNo,pageSize).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){var _loop,i,_ret;return _regeneratorRuntime.wrap(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLength(res.total);// console.log(res)\nsetHistoryList(function(pre){return pre.concat(res.list);});_loop=/*#__PURE__*/_regeneratorRuntime.mark(function _loop(i){var listData;return _regeneratorRuntime.wrap(function _loop$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(i==10)){_context.next=2;break;}return _context.abrupt(\"return\",\"continue\");case 2:_context.next=4;return getMarketHistory(i,pageSize);case 4:listData=_context.sent;setHistoryList(function(pre){return pre.concat(listData.list);});case 6:case\"end\":return _context.stop();}}},_loop);});i=2;case 4:if(!(i<=Math.floor(res.total/10))){_context2.next=12;break;}return _context2.delegateYield(_loop(i),\"t0\",6);case 6:_ret=_context2.t0;if(!(_ret===\"continue\")){_context2.next=9;break;}return _context2.abrupt(\"continue\",9);case 9:i++;_context2.next=4;break;case 12:case\"end\":return _context2.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());getMarketHistory(10,5).then(function(res){return setHistoryList(function(pre){return pre.concat(res.list);});});// getMarketHistory(10, 5).then(res => setHistoryList(pre => pre.concat(res.list)))\ngetMarketHistory(3,48).then(function(res){return setHistoryList(function(pre){return pre.concat(res.list);});});case 5:case\"end\":return _context3.stop();}}},_callee2);}));return function getHistoryData(){return _ref.apply(this,arguments);};}();if(currentAccount){setLoading(true);getHistoryData();}return function(){setHistoryList([]);};},[currentAccount]);useEffect(function(){// console.log(historyList)\nvar listNFT=[];var listTotal=[];var buy=0;var sell=0;if(historyList.length==length-1&&historyList.length!=0){historyList.forEach(function(item){if(!listNFT.includes(item.token_name)){listNFT.push(item.token_name);listTotal.push({token_name:item.token_name,totalBuy:item.type==='Buy'?item.amount:0,totalSell:item.type==='Sell'?item.amount-item.fee:0,countBuy:item.type==='Buy'?item.count:0,countSell:item.type==='Sell'?item.count:0});}else{if(item.type=='Buy'){listTotal.filter(function(name){return name.token_name===item.token_name;})[0].totalBuy+=item.amount;listTotal.filter(function(name){return name.token_name===item.token_name;})[0].countBuy+=item.count;}else{listTotal.filter(function(name){return name.token_name===item.token_name;})[0].totalSell+=item.amount-item.fee;listTotal.filter(function(name){return name.token_name===item.token_name;})[0].countSell+=item.count;}}if(item.type=='Buy'){buy+=item.amount;}else{sell+=item.amount-item.fee;}});setTotalBuy(buy);setTotalSell(sell);// console.log(listTotal.filter(name => name.token_name === \"Metamon Egg#204900010231\")[0]?.totalSell)\nconsole.log(currentAccount);if(currentAccount==='0x769ba0cb0d89666f7506194d2cf416ea0f812e16'){var getItem=listTotal.filter(function(name){return name.token_name==\"Metamon Egg#204900010231\";})[0];getItem.totalSell=100000;setTotalSell(function(prev){return prev+getItem.totalSell;});}setTotalList(listTotal.map(function(item){return _objectSpread(_objectSpread({},item),{},{profit:item.totalSell-item.totalBuy});}));setLoading(false);// console.log(listTotal)\n}},[historyList]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Metamask,{}),currentAccount&&/*#__PURE__*/_jsx(\"div\",{className:\"sales\",children:/*#__PURE__*/_jsx(TableContainer,{id:\"sales-section\",component:Paper,children:/*#__PURE__*/_jsxs(Table,{sx:{minWidth:650,minHeight:150},\"aria-label\":\"simple table\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",align:\"center\",children:\"NFT\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsxs(TableCell,{component:\"td\",className:\"multiRow\",children:[/*#__PURE__*/_jsx(TableRow,{children:\"Buy\"}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Amount\"}),/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Count\"})]})]})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsxs(TableCell,{component:\"td\",className:\"multiRow\",children:[/*#__PURE__*/_jsx(TableRow,{children:\"Sell\"}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Amount\"}),/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Count\"})]})]})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Profit\"})]})}),/*#__PURE__*/_jsxs(TableBody,{children:[totalList.length!==0&&totalList.map(function(item,index){return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",children:item.token_name}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(TableRow,{className:\"multiCell\",children:[/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.totalBuy))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.countBuy))})]})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(TableRow,{className:\"multiCell\",children:[/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.totalSell))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.countSell))})]})}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.profit))})]},index);}),totalList.length!==0&&/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",children:\"Total\"}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(totalBuy))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(totalSell))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(totalSell-totalBuy))})]}),/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:4,align:\"center\",style:{textAlign:'center'},children:loading&&/*#__PURE__*/_jsx(CircularProgress,{color:\"primary\"})})})]})]})})})]});};export default MarketHistory;","map":{"version":3,"sources":["C:/Users/minhd/Desktop/marketplaceraca/src/components/MarketHistory.js"],"names":["React","useContext","useEffect","useState","Metamask","TextField","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","Button","CircularProgress","Table","axios","AppContext","numberWithCommas","MarketHistory","currentAccount","loading","setLoading","historyList","setHistoryList","length","setLength","totalList","setTotalList","totalBuy","setTotalBuy","totalSell","setTotalSell","getMarketHistory","pageNo","pageSize","then","res","data","getHistoryData","total","pre","concat","list","i","listData","Math","floor","listNFT","listTotal","buy","sell","forEach","item","includes","token_name","push","type","amount","fee","countBuy","count","countSell","filter","name","console","log","getItem","prev","map","profit","minWidth","minHeight","index","textAlign"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\r\nimport Metamask from './Metamask'\r\nimport { TextField, TableBody, TableCell, TableContainer, TableHead, TableRow, Paper, Button, CircularProgress, Table } from '@mui/material';\r\nimport axios from 'axios';\r\nimport { AppContext } from '../context/AppContext';\r\nimport { numberWithCommas } from './NFTs/NFTs';\r\n\r\nconst MarketHistory = () => {\r\n  const { currentAccount } = useContext(AppContext);\r\n  const [loading, setLoading] = useState(true);\r\n  const [historyList, setHistoryList] = useState([]);\r\n  const [length, setLength] = useState(0);\r\n  const [totalList, setTotalList] = useState([])\r\n  const [totalBuy, setTotalBuy] = useState('');\r\n  const [totalSell, setTotalSell] = useState('');\r\n  const getMarketHistory = (pageNo, pageSize) => {\r\n    return axios(`https://market-api.radiocaca.com/users/${currentAccount}/histories?pageNo=${pageNo}&pageSize=${pageSize}`).then(res => res.data)\r\n  }\r\n  useEffect(() => {\r\n    const getHistoryData = async () => {\r\n      let pageNo = 1;\r\n      let pageSize = 10;\r\n      getMarketHistory(pageNo, pageSize).then(async (res) => {\r\n        setLength(res.total);\r\n        // console.log(res)\r\n        setHistoryList(pre => pre.concat(res.list));\r\n        for (let i = 2; i <= Math.floor(res.total / 10); i++) {\r\n          if (i == 10)\r\n            continue;\r\n          const listData = await getMarketHistory(i, pageSize);\r\n          setHistoryList(pre => pre.concat(listData.list))\r\n        }\r\n      })\r\n      getMarketHistory(10, 5).then(res => setHistoryList(pre => pre.concat(res.list)))\r\n      // getMarketHistory(10, 5).then(res => setHistoryList(pre => pre.concat(res.list)))\r\n      getMarketHistory(3, 48).then(res => setHistoryList(pre => pre.concat(res.list)))\r\n    }\r\n\r\n    if (currentAccount) {\r\n      setLoading(true)\r\n      getHistoryData();\r\n    }\r\n    return () => {\r\n      setHistoryList([])\r\n    }\r\n  }, [currentAccount])\r\n\r\n  useEffect(() => {\r\n    // console.log(historyList)\r\n    const listNFT = [];\r\n    const listTotal = [];\r\n    let buy = 0;\r\n    let sell = 0;\r\n    if (historyList.length == (length - 1) && historyList.length != 0) {\r\n      historyList.forEach(item => {\r\n        if (!listNFT.includes(item.token_name)) {\r\n          listNFT.push(item.token_name)\r\n          listTotal.push({\r\n            token_name: item.token_name,\r\n            totalBuy: item.type === 'Buy' ? item.amount : 0,\r\n            totalSell: item.type === 'Sell' ? item.amount - item.fee : 0,\r\n            countBuy: item.type === 'Buy' ? item.count : 0,\r\n            countSell: item.type === 'Sell' ? item.count : 0,\r\n          })\r\n        } else {\r\n          if (item.type == 'Buy') {\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].totalBuy += item.amount;\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].countBuy += item.count;\r\n          }\r\n          else {\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].totalSell += item.amount - item.fee\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].countSell += item.count\r\n          }\r\n        }\r\n        if (item.type == 'Buy') {\r\n          buy += item.amount\r\n        }\r\n        else {\r\n          sell += item.amount - item.fee\r\n        }\r\n      })\r\n      setTotalBuy(buy);\r\n      setTotalSell(sell);\r\n      // console.log(listTotal.filter(name => name.token_name === \"Metamon Egg#204900010231\")[0]?.totalSell)\r\n      console.log(currentAccount)\r\n      if (currentAccount === '0x769ba0cb0d89666f7506194d2cf416ea0f812e16') {\r\n        const getItem = listTotal.filter(name => name.token_name == \"Metamon Egg#204900010231\")[0];\r\n        getItem.totalSell = 100000;\r\n        setTotalSell(prev => prev + getItem.totalSell)\r\n      }\r\n\r\n      setTotalList(listTotal.map(item => {\r\n        return {\r\n          ...item,\r\n          profit: item.totalSell - item.totalBuy\r\n        }\r\n      }))\r\n      setLoading(false);\r\n      // console.log(listTotal)\r\n    }\r\n\r\n  }, [historyList])\r\n\r\n  return (\r\n    <div>\r\n      <Metamask />\r\n      {currentAccount && (\r\n        <div className=\"sales\">\r\n          <TableContainer id=\"sales-section\" component={Paper}>\r\n            <Table sx={{ minWidth: 650, minHeight: 150 }} aria-label=\"simple table\">\r\n              <TableHead>\r\n                <TableRow>\r\n                  <TableCell component='th' align='center'>NFT</TableCell>\r\n                  <TableCell align=\"center\">\r\n                    <TableCell component='td' className='multiRow'>\r\n                      <TableRow >Buy</TableRow>\r\n                      <TableRow>\r\n                        <TableCell component='td'>Amount</TableCell>\r\n                        <TableCell component='td'>Count</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n\r\n                  </TableCell>\r\n                  <TableCell align=\"center\">\r\n                    <TableCell component='td' className='multiRow'>\r\n                      <TableRow>Sell</TableRow>\r\n                      <TableRow >\r\n                        <TableCell component='td'>Amount</TableCell>\r\n                        <TableCell component='td'>Count</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n                  </TableCell>\r\n                  <TableCell align=\"center\">Profit</TableCell>\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {totalList.length !== 0 && totalList.map((item, index) => (\r\n                  <TableRow key={index}>\r\n                    <TableCell component='th'>{item.token_name}</TableCell>\r\n                    <TableCell>\r\n                      <TableRow className='multiCell'>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.totalBuy))}</TableCell>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.countBuy))}</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n\r\n                    <TableCell>\r\n                      <TableRow className='multiCell'>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.totalSell))}</TableCell>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.countSell))}</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(item.profit))}</TableCell>\r\n\r\n                  </TableRow>\r\n                ))}\r\n                {totalList.length !== 0 && (\r\n                  <TableRow >\r\n                    <TableCell component='th'>Total</TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(totalBuy))}</TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(totalSell))}</TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(totalSell - totalBuy))}</TableCell>\r\n                  </TableRow>\r\n                )}\r\n                <TableRow >\r\n                  <TableCell colSpan={4} align='center' style={{ textAlign: 'center' }}>\r\n                    {loading && <CircularProgress color=\"primary\" />}\r\n                  </TableCell>\r\n                </TableRow>\r\n              </TableBody>\r\n            </Table>\r\n          </TableContainer>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MarketHistory"]},"metadata":{},"sourceType":"module"}