{"ast":null,"code":"import _objectSpread from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useState}from'react';import Metamask from'./Metamask';import{TextField,TableBody,TableCell,TableContainer,TableHead,TableRow,Paper,Button,CircularProgress,Table}from'@mui/material';import axios from'axios';import{AppContext}from'../context/AppContext';import{numberWithCommas}from'./NFTs/NFTs';import WalletConnect from\"@walletconnect/client\";import QRCodeModal from\"@walletconnect/qrcode-modal\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var MarketHistory=function MarketHistory(){var _useContext=useContext(AppContext),currentAccount=_useContext.currentAccount;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),historyList=_useState4[0],setHistoryList=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),length=_useState6[0],setLength=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),totalList=_useState8[0],setTotalList=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),totalBuy=_useState10[0],setTotalBuy=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),totalSell=_useState12[0],setTotalSell=_useState12[1];var getMarketHistory=function getMarketHistory(pageNo,pageSize){return axios(\"https://market-api.radiocaca.com/users/\".concat(currentAccount,\"/histories?pageNo=\").concat(pageNo,\"&pageSize=\").concat(pageSize)).then(function(res){return res.data;});};useEffect(function(){var getHistoryData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var pageNo,pageSize,isMD;return _regeneratorRuntime.wrap(function _callee2$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:pageNo=1;pageSize=10;isMD=currentAccount=='0x769ba0cb0d89666f7506194d2cf416ea0f812e16';getMarketHistory(pageNo,pageSize).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){var loop,_loop,i,_ret;return _regeneratorRuntime.wrap(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLength(res.total);setHistoryList(function(pre){return pre.concat(res.list);});loop=isMD?Math.floor(res.total/10):Math.floor(res.total/10)+1;_loop=/*#__PURE__*/_regeneratorRuntime.mark(function _loop(i){var listData;return _regeneratorRuntime.wrap(function _loop$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(i==10)){_context.next=2;break;}return _context.abrupt(\"return\",\"continue\");case 2:_context.next=4;return getMarketHistory(i,pageSize);case 4:listData=_context.sent;setHistoryList(function(pre){return pre.concat(listData.list);});case 6:case\"end\":return _context.stop();}}},_loop);});i=2;case 5:if(!(i<=loop)){_context2.next=13;break;}return _context2.delegateYield(_loop(i),\"t0\",7);case 7:_ret=_context2.t0;if(!(_ret===\"continue\")){_context2.next=10;break;}return _context2.abrupt(\"continue\",10);case 10:i++;_context2.next=5;break;case 13:case\"end\":return _context2.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());if(isMD){getMarketHistory(10,5).then(function(res){return setHistoryList(function(pre){return pre.concat(res.list);});});// getMarketHistory(10, 5).then(res => setHistoryList(pre => pre.concat(res.list)))\ngetMarketHistory(3,48).then(function(res){return setHistoryList(function(pre){return pre.concat(res.list);});});}case 5:case\"end\":return _context3.stop();}}},_callee2);}));return function getHistoryData(){return _ref.apply(this,arguments);};}();if(currentAccount){setLoading(true);getHistoryData();}return function(){setHistoryList([]);};},[currentAccount]);useEffect(function(){var listNFT=[];var listTotal=[];var buy=0;var sell=0;var lengthList=length;if(currentAccount=='0x769ba0cb0d89666f7506194d2cf416ea0f812e16'){lengthList--;}if(historyList.length==lengthList&&historyList.length!=0){historyList.forEach(function(item){if(!listNFT.includes(item.token_name)){listNFT.push(item.token_name);listTotal.push({token_name:item.token_name,totalBuy:item.type==='Buy'?item.amount:0,totalSell:item.type==='Sell'?item.amount-item.fee:0,countBuy:item.type==='Buy'?item.count:0,countSell:item.type==='Sell'?item.count:0});}else{if(item.type=='Buy'){listTotal.filter(function(name){return name.token_name===item.token_name;})[0].totalBuy+=item.amount;listTotal.filter(function(name){return name.token_name===item.token_name;})[0].countBuy+=item.count;}else{listTotal.filter(function(name){return name.token_name===item.token_name;})[0].totalSell+=item.amount-item.fee;listTotal.filter(function(name){return name.token_name===item.token_name;})[0].countSell+=item.count;}}if(item.type=='Buy'){buy+=item.amount;}else{sell+=item.amount-item.fee;}});setTotalBuy(buy);setTotalSell(sell);// console.log(listTotal.filter(name => name.token_name === \"Metamon Egg#204900010231\")[0]?.totalSell)\nif(currentAccount=='0x769ba0cb0d89666f7506194d2cf416ea0f812e16'){var getItem=listTotal.filter(function(name){return name.token_name==\"Metamon Egg#204900010231\";})[0];getItem.totalSell=100000;setTotalSell(function(prev){return prev+getItem.totalSell;});}setTotalList(listTotal.map(function(item){return _objectSpread(_objectSpread({},item),{},{profit:item.totalSell-item.totalBuy});}));setLoading(false);// console.log(listTotal)\n}},[historyList]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Metamask,{}),currentAccount&&/*#__PURE__*/_jsx(\"div\",{className:\"sales\",children:/*#__PURE__*/_jsx(TableContainer,{id:\"sales-section\",component:Paper,children:/*#__PURE__*/_jsxs(Table,{sx:{minWidth:650,minHeight:150},\"aria-label\":\"simple table\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",align:\"center\",children:\"NFT\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsxs(TableCell,{component:\"td\",className:\"multiRow\",children:[/*#__PURE__*/_jsx(TableRow,{children:\"Buy\"}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Amount\"}),/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Count\"})]})]})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsxs(TableCell,{component:\"td\",className:\"multiRow\",children:[/*#__PURE__*/_jsx(TableRow,{children:\"Sell\"}),/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Amount\"}),/*#__PURE__*/_jsx(TableCell,{component:\"td\",children:\"Count\"})]})]})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Profit\"})]})}),/*#__PURE__*/_jsxs(TableBody,{children:[totalList.length!==0&&totalList.map(function(item,index){return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",children:item.token_name}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(TableRow,{className:\"multiCell\",children:[/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.totalBuy))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.countBuy))})]})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsxs(TableRow,{className:\"multiCell\",children:[/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.totalSell))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.countSell))})]})}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(item.profit))})]},index);}),totalList.length!==0&&/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",children:\"Total\"}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(totalBuy))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(totalSell))}),/*#__PURE__*/_jsx(TableCell,{children:numberWithCommas(Math.floor(totalSell-totalBuy))})]}),/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:4,align:\"center\",style:{textAlign:'center'},children:loading&&/*#__PURE__*/_jsx(CircularProgress,{color:\"primary\"})})})]})]})})})]});};export default MarketHistory;","map":{"version":3,"sources":["C:/Users/minhd/Desktop/marketplaceraca/src/components/MarketHistory.js"],"names":["React","useContext","useEffect","useState","Metamask","TextField","TableBody","TableCell","TableContainer","TableHead","TableRow","Paper","Button","CircularProgress","Table","axios","AppContext","numberWithCommas","WalletConnect","QRCodeModal","MarketHistory","currentAccount","loading","setLoading","historyList","setHistoryList","length","setLength","totalList","setTotalList","totalBuy","setTotalBuy","totalSell","setTotalSell","getMarketHistory","pageNo","pageSize","then","res","data","getHistoryData","isMD","total","pre","concat","list","loop","Math","floor","i","listData","listNFT","listTotal","buy","sell","lengthList","forEach","item","includes","token_name","push","type","amount","fee","countBuy","count","countSell","filter","name","getItem","prev","map","profit","minWidth","minHeight","index","textAlign"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\r\nimport Metamask from './Metamask'\r\nimport { TextField, TableBody, TableCell, TableContainer, TableHead, TableRow, Paper, Button, CircularProgress, Table } from '@mui/material';\r\nimport axios from 'axios';\r\nimport { AppContext } from '../context/AppContext';\r\nimport { numberWithCommas } from './NFTs/NFTs';\r\nimport WalletConnect from \"@walletconnect/client\";\r\nimport QRCodeModal from \"@walletconnect/qrcode-modal\";\r\n\r\n\r\nconst MarketHistory = () => {\r\n  const { currentAccount } = useContext(AppContext);\r\n  const [loading, setLoading] = useState(true);\r\n  \r\n  const [historyList, setHistoryList] = useState([]);\r\n  const [length, setLength] = useState(0);\r\n  const [totalList, setTotalList] = useState([])\r\n  const [totalBuy, setTotalBuy] = useState('');\r\n  const [totalSell, setTotalSell] = useState('');\r\n  const getMarketHistory = (pageNo, pageSize) => {\r\n    return axios(`https://market-api.radiocaca.com/users/${currentAccount}/histories?pageNo=${pageNo}&pageSize=${pageSize}`).then(res => res.data)\r\n  }\r\n  useEffect(() => {\r\n    const getHistoryData = async () => {\r\n      let pageNo = 1;\r\n      let pageSize = 10;\r\n      const isMD = currentAccount == '0x769ba0cb0d89666f7506194d2cf416ea0f812e16';\r\n      getMarketHistory(pageNo, pageSize).then(async (res) => {\r\n        setLength(res.total);\r\n        setHistoryList(pre => pre.concat(res.list));\r\n        const loop = isMD ? Math.floor(res.total / 10) : Math.floor(res.total / 10) + 1;\r\n        for (let i = 2; i <= loop; i++) {\r\n          if (i == 10)\r\n            continue;\r\n          const listData = await getMarketHistory(i, pageSize);\r\n          setHistoryList(pre => pre.concat(listData.list))\r\n        }\r\n      })\r\n      if (isMD) {\r\n        getMarketHistory(10, 5).then(res => setHistoryList(pre => pre.concat(res.list)))\r\n        // getMarketHistory(10, 5).then(res => setHistoryList(pre => pre.concat(res.list)))\r\n        getMarketHistory(3, 48).then(res => setHistoryList(pre => pre.concat(res.list)))\r\n      }\r\n\r\n    }\r\n\r\n    if (currentAccount) {\r\n      setLoading(true)\r\n      getHistoryData();\r\n    }\r\n    return () => {\r\n      setHistoryList([])\r\n    }\r\n  }, [currentAccount])\r\n\r\n  useEffect(() => {\r\n    const listNFT = [];\r\n    const listTotal = [];\r\n    let buy = 0;\r\n    let sell = 0;\r\n    let lengthList = length;\r\n    if (currentAccount == '0x769ba0cb0d89666f7506194d2cf416ea0f812e16') {\r\n      lengthList--;\r\n    }\r\n    if (historyList.length == lengthList && historyList.length != 0) {\r\n      historyList.forEach(item => {\r\n        if (!listNFT.includes(item.token_name)) {\r\n          listNFT.push(item.token_name)\r\n          listTotal.push({\r\n            token_name: item.token_name,\r\n            totalBuy: item.type === 'Buy' ? item.amount : 0,\r\n            totalSell: item.type === 'Sell' ? item.amount - item.fee : 0,\r\n            countBuy: item.type === 'Buy' ? item.count : 0,\r\n            countSell: item.type === 'Sell' ? item.count : 0,\r\n          })\r\n        } else {\r\n          if (item.type == 'Buy') {\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].totalBuy += item.amount;\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].countBuy += item.count;\r\n          }\r\n          else {\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].totalSell += item.amount - item.fee\r\n            listTotal.filter(name => name.token_name === item.token_name)[0].countSell += item.count\r\n          }\r\n        }\r\n        if (item.type == 'Buy') {\r\n          buy += item.amount\r\n        }\r\n        else {\r\n          sell += item.amount - item.fee\r\n        }\r\n      })\r\n      setTotalBuy(buy);\r\n      setTotalSell(sell);\r\n      // console.log(listTotal.filter(name => name.token_name === \"Metamon Egg#204900010231\")[0]?.totalSell)\r\n      if (currentAccount == '0x769ba0cb0d89666f7506194d2cf416ea0f812e16') {\r\n        const getItem = listTotal.filter(name => name.token_name == \"Metamon Egg#204900010231\")[0];\r\n        getItem.totalSell = 100000;\r\n        setTotalSell(prev => prev + getItem.totalSell)\r\n      }\r\n\r\n      setTotalList(listTotal.map(item => {\r\n        return {\r\n          ...item,\r\n          profit: item.totalSell - item.totalBuy\r\n        }\r\n      }))\r\n      setLoading(false);\r\n      // console.log(listTotal)\r\n    }\r\n\r\n  }, [historyList])\r\n\r\n  return (\r\n    <div>\r\n      <Metamask />\r\n      {currentAccount && (\r\n        <div className=\"sales\">\r\n          <TableContainer id=\"sales-section\" component={Paper}>\r\n            <Table sx={{ minWidth: 650, minHeight: 150 }} aria-label=\"simple table\">\r\n              <TableHead>\r\n                <TableRow>\r\n                  <TableCell component='th' align='center'>NFT</TableCell>\r\n                  <TableCell align=\"center\">\r\n                    <TableCell component='td' className='multiRow'>\r\n                      <TableRow >Buy</TableRow>\r\n                      <TableRow>\r\n                        <TableCell component='td'>Amount</TableCell>\r\n                        <TableCell component='td'>Count</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n\r\n                  </TableCell>\r\n                  <TableCell align=\"center\">\r\n                    <TableCell component='td' className='multiRow'>\r\n                      <TableRow>Sell</TableRow>\r\n                      <TableRow >\r\n                        <TableCell component='td'>Amount</TableCell>\r\n                        <TableCell component='td'>Count</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n                  </TableCell>\r\n                  <TableCell align=\"center\">Profit</TableCell>\r\n                </TableRow>\r\n              </TableHead>\r\n              <TableBody>\r\n                {totalList.length !== 0 && totalList.map((item, index) => (\r\n                  <TableRow key={index}>\r\n                    <TableCell component='th'>{item.token_name}</TableCell>\r\n                    <TableCell>\r\n                      <TableRow className='multiCell'>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.totalBuy))}</TableCell>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.countBuy))}</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n\r\n                    <TableCell>\r\n                      <TableRow className='multiCell'>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.totalSell))}</TableCell>\r\n                        <TableCell >{numberWithCommas(Math.floor(item.countSell))}</TableCell>\r\n                      </TableRow>\r\n                    </TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(item.profit))}</TableCell>\r\n\r\n                  </TableRow>\r\n                ))}\r\n                {totalList.length !== 0 && (\r\n                  <TableRow >\r\n                    <TableCell component='th'>Total</TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(totalBuy))}</TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(totalSell))}</TableCell>\r\n                    <TableCell>{numberWithCommas(Math.floor(totalSell - totalBuy))}</TableCell>\r\n                  </TableRow>\r\n                )}\r\n                <TableRow >\r\n                  <TableCell colSpan={4} align='center' style={{ textAlign: 'center' }}>\r\n                    {loading && <CircularProgress color=\"primary\" />}\r\n                  </TableCell>\r\n                </TableRow>\r\n              </TableBody>\r\n            </Table>\r\n          </TableContainer>\r\n        </div>\r\n      )}\r\n\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MarketHistory"]},"metadata":{},"sourceType":"module"}