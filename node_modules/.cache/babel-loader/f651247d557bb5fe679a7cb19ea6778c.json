{"ast":null,"code":"import _objectSpread from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/minhd/Desktop/marketplaceraca/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import axios from'axios';import React from'react';import{useEffect,useState}from'react';import InputFilters from'./InputFilters';import'../../styles/elemon.css';import{Box,CircularProgress,Grid}from'@mui/material';import InfoCard from'./InfoCard';import{useDispatch,useSelector}from'react-redux';import{handlePower}from'../../app/actions';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var getElemonItem=function getElemonItem(){var pageNumber=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var pageSize=arguments.length>1&&arguments[1]!==undefined?arguments[1]:20;var priceMode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;var baseCardId=arguments.length>3?arguments[3]:undefined;var tokenId=arguments.length>4?arguments[4]:undefined;var rarities=arguments.length>5?arguments[5]:undefined;var classes=arguments.length>6?arguments[6]:undefined;var purities=arguments.length>7?arguments[7]:undefined;return axios.get(\"https://app.elemon.io/market/getElemonItems?pageNumber=\".concat(pageNumber,\"&pageSize=\").concat(pageSize,\"&positionType=2&priceMode=\").concat(priceMode,\"&baseCardId=&tokenId=&rarities=&classes=&purities=\")).then(function(res){return res.data;},{headers:{\"Access-Control-Allow-Origin\":\"*\"}});};var getElemonInfo=function getElemonInfo(listElemon){var listTokenId=listElemon.map(function(item){return item.tokenId;});return axios.get(\"https://app.elemon.io/elemon/GetElemonInfo?tokenId=\".concat(listTokenId===null||listTokenId===void 0?void 0:listTokenId.join(','))).then(function(res){return res.data;},{headers:{\"Access-Control-Allow-Origin\":\"*\"}}).catch(function(error){return error;});};var Elemon=function Elemon(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),listElemon=_useState2[0],setListElemon=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),listElemonInfo=_useState4[0],setListElemonInfo=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),timeUpdated=_useState6[0],setTimeUpdated=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),listFilter=_useState10[0],setListFilter=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),myNFT=_useState12[0],setMyNFT=_useState12[1];var _useSelector=useSelector(function(state){return state.filtersElemon;}),min=_useSelector.min,max=_useSelector.max,sort=_useSelector.sort,name=_useSelector.name,tokenId=_useSelector.tokenId;var dispatch=useDispatch();var convertDateTime=function convertDateTime(){var now=new Date();setTimeUpdated(now.toLocaleString());};useEffect(function(){var getData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getElemonItem(1,100).then(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(res){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getElemonItem(1,res.paging.totalCount).then(function(res){return setListElemon(res.data);});case 2:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function getData(){return _ref.apply(this,arguments);};}();getData();convertDateTime();return function(){setListElemon([]);};},[]);React.useEffect(function(){var getInfo=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var size,lengthList,loop,_loop,i;return _regeneratorRuntime.wrap(function _callee3$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setLoading(true);size=250;lengthList=listElemon.length;loop=lengthList%size===0?lengthList/size:lengthList/size+1;_loop=/*#__PURE__*/_regeneratorRuntime.mark(function _loop(i){var amount;return _regeneratorRuntime.wrap(function _loop$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:amount=lengthList%size!==0&&lengthList-i*size<0?(i-1)*size+lengthList%size:i*size;_context3.next=3;return getElemonInfo(listElemon===null||listElemon===void 0?void 0:listElemon.slice((i-1)*size,amount)).then(function(res){var listInfo=listElemon.slice((i-1)*size,amount).map(function(item,index){try{var _res$data$index2;if(item.ownerAddress==='0x769Ba0Cb0D89666F7506194D2cF416Ea0F812e16'&&index!==undefined){var _res$data$index;item.point=(_res$data$index=res.data[index])===null||_res$data$index===void 0?void 0:_res$data$index.point;dispatch(handlePower({minPower:item.point-(item.point%100000+50000),maxPower:max}));setMyNFT(item);}return _objectSpread(_objectSpread({},item),{},{point:res===null||res===void 0?void 0:(_res$data$index2=res.data[index])===null||_res$data$index2===void 0?void 0:_res$data$index2.point});}catch(err){console.log(err);}});setListElemonInfo(function(pre){return pre.concat(listInfo);});});case 3:case\"end\":return _context3.stop();}}},_loop);});i=1;case 6:if(!(i<=loop)){_context4.next=11;break;}return _context4.delegateYield(_loop(i),\"t0\",8);case 8:i++;_context4.next=6;break;case 11:setLoading(false);case 12:case\"end\":return _context4.stop();}}},_callee3);}));return function getInfo(){return _ref3.apply(this,arguments);};}();getInfo();return function(){setListElemonInfo([]);};},[listElemon]);useEffect(function(){var filter=listElemonInfo.filter(function(elemon){var maxP=max;var minP=min;if(tokenId){return elemon.tokenId===tokenId;}else{var checkPower=function checkPower(power,type){if(!power)return true;return type===1?(elemon===null||elemon===void 0?void 0:elemon.point)>=power:(elemon===null||elemon===void 0?void 0:elemon.point)<=power;};if(Number(name)!==0){return checkPower(minP,1)&&checkPower(maxP,2)&&elemon.baseCardId===name;}return checkPower(minP,1)&&checkPower(maxP,2);}}).sort(function(a,b){switch(Number(sort)){case 0:return a.lastPrice>=b.lastPrice?1:-1;case 1:return a.lastPrice<=b.lastPrice?1:-1;case 2:return a.point>=b.point?1:-1;case 3:return a.point<=b.point?1:-1;default:break;}});setListFilter(filter);return function(){setListFilter([]);};},[loading,min,max,sort,name,tokenId]);return/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'center'},children:[/*#__PURE__*/_jsx(InputFilters,{}),/*#__PURE__*/_jsx(\"p\",{className:\"timeUpdate\",children:timeUpdated}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:1,children:[myNFT&&/*#__PURE__*/_jsx(Grid,{item:true,xs:6,md:4,lg:2.2,children:/*#__PURE__*/_jsx(InfoCard,{elemon:myNFT})}),listFilter&&(listFilter===null||listFilter===void 0?void 0:listFilter.slice(0,100).map(function(item,index){return/*#__PURE__*/_jsx(Grid,{item:true,xs:6,md:4,lg:2.2,children:/*#__PURE__*/_jsx(InfoCard,{elemon:item})},index);}))]}),loading&&/*#__PURE__*/_jsx(CircularProgress,{})]})});};export default Elemon;","map":{"version":3,"sources":["C:/Users/minhd/Desktop/marketplaceraca/src/components/Elemon/Elemon.js"],"names":["axios","React","useEffect","useState","InputFilters","Box","CircularProgress","Grid","InfoCard","useDispatch","useSelector","handlePower","getElemonItem","pageNumber","pageSize","priceMode","baseCardId","tokenId","rarities","classes","purities","get","then","res","data","headers","getElemonInfo","listElemon","listTokenId","map","item","join","catch","error","Elemon","setListElemon","listElemonInfo","setListElemonInfo","timeUpdated","setTimeUpdated","loading","setLoading","listFilter","setListFilter","myNFT","setMyNFT","state","filtersElemon","min","max","sort","name","dispatch","convertDateTime","now","Date","toLocaleString","getData","paging","totalCount","getInfo","size","lengthList","length","loop","i","amount","slice","listInfo","index","ownerAddress","undefined","point","minPower","maxPower","err","console","log","pre","concat","filter","elemon","maxP","minP","checkPower","power","type","Number","a","b","lastPrice","textAlign"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport React from 'react';\r\nimport { useEffect, useState } from 'react';\r\nimport InputFilters from './InputFilters';\r\nimport '../../styles/elemon.css';\r\nimport { Box, CircularProgress, Grid } from '@mui/material';\r\nimport InfoCard from './InfoCard';\r\nimport { useDispatch, useSelector } from 'react-redux';\r\nimport { handlePower } from '../../app/actions';\r\n\r\n\r\nconst getElemonItem = (pageNumber = 1, pageSize = 20, priceMode = 2, baseCardId, tokenId, rarities, classes, purities) => {\r\n    return axios.get(`https://app.elemon.io/market/getElemonItems?pageNumber=${pageNumber}&pageSize=${pageSize}&positionType=2&priceMode=${priceMode}&baseCardId=&tokenId=&rarities=&classes=&purities=`).then(res => res.data, {\r\n        headers: {\r\n            \"Access-Control-Allow-Origin\": \"*\"\r\n        }\r\n    });\r\n}\r\nconst getElemonInfo = (listElemon) => {\r\n    const listTokenId = listElemon.map(item => item.tokenId);\r\n    return axios.get(`https://app.elemon.io/elemon/GetElemonInfo?tokenId=${listTokenId?.join(',')}`).then(res => res.data, {\r\n        headers: {\r\n            \"Access-Control-Allow-Origin\": \"*\"\r\n        }\r\n    }).catch(error => (error));\r\n}\r\n\r\nconst Elemon = () => {\r\n    const [listElemon, setListElemon] = useState([]);\r\n    const [listElemonInfo, setListElemonInfo] = useState([]);\r\n    const [timeUpdated, setTimeUpdated] = useState(\"\")\r\n    const [loading, setLoading] = useState(true);\r\n    const [listFilter, setListFilter] = useState([]);\r\n    const [myNFT, setMyNFT] = useState();\r\n    const { min, max, sort, name, tokenId } = useSelector(state => state.filtersElemon)\r\n\r\n    const dispatch = useDispatch();\r\n    const convertDateTime = () => {\r\n        const now = new Date();\r\n        setTimeUpdated(now.toLocaleString())\r\n    }\r\n    useEffect(() => {\r\n        const getData = async () => {\r\n            await getElemonItem(1, 100).then(async (res) => {\r\n                await getElemonItem(1, res.paging.totalCount).then(res => setListElemon(res.data));\r\n            });\r\n        }\r\n        getData();\r\n        convertDateTime()\r\n\r\n        return () => {\r\n            setListElemon([]);\r\n        }\r\n    }, [])\r\n\r\n    React.useEffect(() => {\r\n        const getInfo = async () => {\r\n            setLoading(true)\r\n            const size = 250;\r\n            const lengthList = listElemon.length;\r\n            const loop = lengthList % size === 0 ? lengthList / size : lengthList / size + 1;\r\n            for (let i = 1; i <= loop; i++) {\r\n                const amount = lengthList % size !== 0 && lengthList - (i * size) < 0 ? ((i - 1) * size) + (lengthList % size) : i * size\r\n                await getElemonInfo(listElemon?.slice((i - 1) * size, amount)).then(res => {\r\n                    const listInfo = listElemon.slice((i - 1) * size, amount).map((item, index) => {\r\n                        try {\r\n                            if (item.ownerAddress === '0x769Ba0Cb0D89666F7506194D2cF416Ea0F812e16' && index !== undefined) {\r\n                                item.point = res.data[index]?.point;\r\n                                dispatch(handlePower({ minPower: item.point - (item.point % 100000 + 50000), maxPower: max }))\r\n                                setMyNFT(item);\r\n                            }\r\n                            return {\r\n                                ...item,\r\n                                point: res?.data[index]?.point,\r\n                            }\r\n                        }\r\n                        catch (err) {\r\n                            console.log(err)\r\n                        }\r\n                    });\r\n                    setListElemonInfo(pre => pre.concat(listInfo))\r\n                })\r\n            }\r\n\r\n            setLoading(false);\r\n        }\r\n        getInfo();\r\n        return () => {\r\n            setListElemonInfo([]);\r\n        }\r\n    }, [listElemon]);\r\n    useEffect(() => {\r\n        const filter = listElemonInfo.filter(elemon => {\r\n            let maxP = max;\r\n            let minP = min;\r\n            if (tokenId) {\r\n                return elemon.tokenId === tokenId;\r\n            } else {\r\n                const checkPower = (power, type) => {\r\n                    if (!power)\r\n                        return true;\r\n                    return type === 1 ? elemon?.point >= power : elemon?.point <= power\r\n                }\r\n                if (Number(name) !== 0) {\r\n                    return checkPower(minP, 1) && checkPower(maxP, 2) && elemon.baseCardId === name;\r\n                }\r\n                return checkPower(minP, 1) && checkPower(maxP, 2)\r\n            }\r\n        }).sort((a, b) => {\r\n            switch (Number(sort)) {\r\n                case 0:\r\n                    return a.lastPrice >= b.lastPrice ? 1 : -1;\r\n                case 1:\r\n                    return a.lastPrice <= b.lastPrice ? 1 : -1;\r\n                case 2:\r\n                    return a.point >= b.point ? 1 : -1;\r\n                case 3:\r\n                    return a.point <= b.point ? 1 : -1;\r\n                default:\r\n                    break;\r\n            }\r\n        })\r\n\r\n        setListFilter(filter)\r\n        return () => {\r\n            setListFilter([])\r\n        }\r\n    }, [loading, min, max, sort, name, tokenId]);\r\n\r\n\r\n    return (\r\n        <Box>\r\n            <Box sx={{ textAlign: 'center' }}>\r\n                <InputFilters />\r\n                <p className='timeUpdate'>{timeUpdated}</p>\r\n                <Grid container spacing={1}>\r\n                    {myNFT && (\r\n                        <Grid item xs={6} md={4} lg={2.2}>\r\n                            <InfoCard elemon={myNFT} />\r\n                        </Grid>\r\n                    )}\r\n\r\n                    {listFilter && listFilter?.slice(0, 100).map((item, index) => (\r\n                        <Grid key={index} item xs={6} md={4} lg={2.2}>\r\n                            <InfoCard elemon={item} />\r\n                        </Grid>\r\n                    ))}\r\n                </Grid>\r\n                {loading && <CircularProgress />}\r\n            </Box>\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default Elemon;\r\n"]},"metadata":{},"sourceType":"module"}